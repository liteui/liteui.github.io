//Выплывающий блок
$(window).scroll(function(){
    if ($(this).scrollTop()>50) {
        $(".fixed-buttonblock").addClass("active");
    } else { $(".fixed-buttonblock").removeClass("active"); }
});





// Социальные кнопки
$(".socials").sharepage({
  networks: ["facebook", "vk", "twitter"],
  url: "http://sms-assistent.by/",
  title: "SMS Ассистент",
  source: "Выгодная рассылка SMS для бизнеса",
  width: 650,
  height: 600,
  design: "buttons"
});





// Анимации и параллакс
if ($(window).width()>1024) {

// Плавное появление блоков при скролле
window.sr = ScrollReveal();
sr.reveal('section.firstscreen .envelopes img:nth-child(1)', {delay: 100, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('section.firstscreen .envelopes img:nth-child(9)', {delay: 150, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('section.firstscreen .envelopes img:nth-child(4)', {delay: 200, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 900});
sr.reveal('section.firstscreen .envelopes img:nth-child(2)', {delay: 250, distance: '800px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1200});
sr.reveal('section.firstscreen .envelopes img:nth-child(8)', {delay: 300, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('section.firstscreen .envelopes img:nth-child(7)', {delay: 200, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('section.firstscreen .envelopes img:nth-child(6)', {delay: 400, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('section.firstscreen .envelopes img:nth-child(3)', {delay: 450, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('section.firstscreen .envelopes img:nth-child(5)', {delay: 300, distance: '700px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('.bottom-img', {delay: 400, distance: '300px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});

// Параллакс бекграунда во втором блоке
function scrollsecond() {
    var el = $("section.second");
    var h1 = el.offset().top;
    var sectionheight = el.height();
    var scroll = $(window).scrollTop();
    if ( (scroll > (h1 - $(window).height())) ) {
        var percents = scroll/sectionheight;
        $("section.second .bg").css("top", (200-percents*150)+"px");
    }
}

scrollsecond();

// Параллакс бекграунда в четвертом блоке
function scrollfourth() {
    var el = $("section.fourth");
    var h1 = el.offset().top;
    var sectionheight = el.height();
    var scroll = $(window).scrollTop();
    if ( (scroll > (h1 - $(window).height())) ) {
        var percents = scroll/sectionheight;
        $("section.fourth .bg").css("top", (300-percents*200)+"px");
    }
}

scrollfourth();

$(window).scroll(function(){
    scrollsecond();
    scrollfourth();
});

}





// Переключение слайдов в калькуляторе
$("section.third .controls li").click(function(){
   if (!$(this).hasClass("active")) {
       $(this).parent().find(".active").removeClass("active");
       $(this).addClass("active");
       var wwidth = $(this).outerWidth();
       var lleft = $(this).position().left;
       $("section.third .controls li.navbar").width(wwidth).css("left", lleft);
       
       if (!$(this).attr("data-state")) {
           $("section.third").removeClass("active");
       } else {$("section.third").addClass("active");}
   }
});





//Изменение данных формы
$("form select").on("keyup change", function(){
	$(this).parent().addClass("active");
	if ($(this).find("option:selected").hasClass("type")) {
		$(this).parent().removeClass("active");
	}
});

$("form input").on("keyup change", function(){
	$(this).parent().addClass("active");
	if (!$(this).val()) {
		$(this).parent().removeClass("active");
	}
});





// Кастомный выпадающий список
window.select1val = false;
$('select[name="city"]').selectmenu({change: function( event, data ) {
    if ( data.item.value != "" ) {$('select[name="city"]').parent().addClass("active").removeClass("error"); window.select1val = true}
}});

window.select2val = false;
$('select[name="clienttype"]').selectmenu({change: function( event, data ) {
    if ( data.item.value != "" ) {$('select[name="clienttype"]').parent().addClass("active").removeClass("error"); window.select2val = true}
    if ( data.item.value === "utFirm" ) {
        $("form .yurlico").css("display", "inline-block").find("input").attr("data-required", "");
        $("form .fizlico").css("display", "none").find("input").removeAttr("data-required");
    }
    if ( data.item.value === "utIp" ) {
        $("form .fizlico").css("display", "inline-block").find("input").attr("data-required", "");
        $("form .yurlico").css("display", "none").find("input").removeAttr("data-required");
    }
}});

window.select3val = false;
$('select[name="orgform"]').selectmenu({change: function( event, data ) {
    if ( data.item.value != "" ) {$('select[name="orgform"]').parent().addClass("active").removeClass("error"); window.select3val = true}
}});





// Проверка формы на правильность введенных данных
$(".fake-button").click(function(){
    window.activeform = $(this).parents("form").attr("id");

    checkselects();
    checkinputs();
    checkandsubmit();
});

// 1. Проверка селектов
function checkselects() {
    if (select1val === false) { $('#'+activeform+' select[name="city"]').parent().addClass("error"); }
    if (select2val === false) { $('#'+activeform+' select[name="clienttype"]').parent().addClass("error"); }
    if (select3val === false) { $('#'+activeform+' select[name="orgform"]').parent().addClass("error"); }
}

// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();
    
    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').parent().addClass("error")
    } else {$('#'+activeform+' input[name="email"]').parent().removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find("div.error").each(function(){
        formerrors += 1; 
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' input[data-required]').each(function(){
        if (!$(this).val()) {
            $(this).parent().addClass("error")
        } else {$(this).parent().removeClass("error")}
    });
}





// Убрать ошибку при изменении input'а
$("input").on("keyup change", function(){
   $(this).parent().removeClass("error"); 
});





// Только цифры в input'е
$('.onlynumber').change(function(e){
  if (/\D/g.test(this.value))
  {
    this.value = this.value.replace(/\D/g, '');
  }
});




// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});





// Скрипт работы калькулятора
// Базовые значение
window.smsbenefitpercent = 0.05; // Процент выгоды смс
window.smsbackpercent = 0.10; // Процент выгоды смс
window.smsamount = 10000; // Базовое кол-во СМС
window.smsmin = 1000; // Минимальное кол-во
window.smsmax = 500000 // Максимальное кол-во

// 1. Получить значение из поля ввода, форматировать его
$("section.third .calculator input").change(function(){
    window.smsamount = parseInt($(this).val());
    smsamountfunc();
});

function smsamountfunc() {
    // Проверка на минимум и максимум
    if (smsamount < smsmin) {smsamount = smsmin}
    else if (smsamount > smsmax) {smsamount = smsmax}
    
    // 2. Синхронизация значений полей ввода
    $("section.third .calculator input").val(commafy(smsamount));
    $(".range").slider("value", smsamount);
    
    smspricefunc(); calcall();
}

// 3. Назначение цены за SMS
function smspricefunc() {
    if (smsamount >= 1000)   {window.smsprice = 0.015}
    if (smsamount >= 3000)   {window.smsprice = 0.014}
    if (smsamount >= 5000)   {window.smsprice = 0.013}
    if (smsamount >= 10000)  {window.smsprice = 0.012}
    if (smsamount >= 50000)  {window.smsprice = 0.010}
    if (smsamount >= 100000) {window.smsprice = 0.009}
}

function calcall() {
    // 4. Расчет BYN
    window.smsbyn = parseFloat(smsamount * smsprice).toFixed(2);
    $("#smsbyn, #smsbyn2").text(smsbyn.replace(".", ","));
    
    // 5. Расчет 5% SMS
    window.smsbenefit = parseFloat(smsamount * smsbenefitpercent).toFixed(0);
    $("#smsbenefit").text(smsbenefit);
    
    // 6. Расчет выгоды
    window.smsbenefitbyn = parseFloat(smsbyn * smsbenefitpercent).toFixed(2);
    $("#smsbenefitbyn").text(smsbenefitbyn.replace(".", ","));
    
    // 7. Расчет возврата 10%
    window.smsback = parseFloat(smsamount * smsbackpercent).toFixed(0);
    $("#smsback").text(smsback);
    
    // 8. Расчет выгоды возврата
    window.smsbackbyn = parseFloat(smsbyn * smsbackpercent).toFixed(2);
    $("#smsbackbyn").text(smsbackbyn.replace(".", ","));
}





// Ползунок в калькуляторе
$(".range").slider({
  range: "min",
  value: smsamount,
  min: smsmin,
  max: smsmax,
  step: 1000, // Шаг при движении слайдера
  slide: function( event, ui ) {
    window.smsamount = ui.value
    smsamountfunc();
  }
});





// Всплывающие окна
$(".fancybox").fancybox({
    fitToView   : false,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
});





// Скрипт, разделяющий числа по 3 цифры пробелами
function commafy( num ) {
    var str = num.toString().split('.');
    if (str[0].length >= 3) {
        str[0] = str[0].replace(/(\d)(?=(\d{3})+$)/g, '$1 ');
    }
    if (str[1] && str[1].length >= 3) {
        str[1] = str[1].replace(/(\d{3})/g, '$1 ');
    }
    return str.join('.');
}





// Закрыть попап
$(".closepopup").click(function(){
   $.fancybox.close(); 
});





// AJAX форма
$(document).ready(function() {
    $('form#mainform').ajaxForm(function() {
        // Успешная отправка формы
        $.fancybox([{href: '#success', fitToView: false, autoSize: true, openEffect: 'fade', closeEffect: 'fade',}]);
    }); 
    
    $('form#callform').ajaxForm(function() {
        // Успешная отправка формы
        $.fancybox([{href: '#callsuccess', fitToView: false, autoSize: true, openEffect: 'fade', closeEffect: 'fade',}]);
    }); 
}); 





// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+375 (99) 999-99-99");
});