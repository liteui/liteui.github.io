//Мобильное меню
function showOverlay() {
    $(".page-overlay").addClass("active");
}

function hideOverlay() {
    $(".page-overlay").removeClass("active");
}

function openMenu() {
    $('.header__burgermenu, .header__side').addClass("active");
    fixscreen();
    showOverlay();
}

function closeMenu() {
    $('.header__burgermenu, .header__side').removeClass("active");
    unfixscreen();
    hideOverlay();
}

$('.header__burgermenu').click(function(){
    if ($(this).hasClass("active")) {
        closeMenu();
    } else {
        openMenu();
    }
});

$('.header__side').on("swiperight",function(){
  	closeMenu();
});

//Карточки на странице technology
$('.technology__card').click(function(){
	$('.technology__card').not(this).removeClass('active');
	$(this).toggleClass('active');
});

//Переключение вида блоков на странице cases
$('.cases__switcher li').click(function(){
	$(this).siblings().removeClass('active');
	$(this).addClass('active');
	var casewidth = $(this).attr('data-width');
	if ( casewidth == "squares" ) {
		$('.cases__list').addClass('squares');
	} else {
		$('.cases__list').removeClass('squares');
	}
});

//Карта на странице contacts в мобилке
$('.contacts__pinsquare').click(function(){
	$(this).toggleClass('active');
	$('.contacts__map').toggleClass('active');
});

//Фильтр кейсов
$('.case__filter').click(function(e){
	e.preventDefault();
	$('.case__filter.active').removeClass('active');
	$(this).addClass('active');
	var category = $(this).attr('data-category');
	if (category == "all") {
		$('.cases__list > li').show();
	} else {
		$('.cases__list > li').hide();
        $('.cases__list > li').each(function(){
            var nam = $(this).data("category");
            if (nam.indexOf(category) > -1) {$(this).show();}
        });
	}
});

//Поделиться на странице кейса
$('.squareblock__social').click(function(e){
	e.preventDefault();
	alert("Hello!");
})



// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal = {delay: 100, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: true, duration: 1000};
var fooReveal1 = {delay: 200, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: true, duration: 1000};
var fooReveal2 = {delay: 300, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: true, duration: 1000};
var fooReveal3 = {delay: 400, distance: '50px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: true, duration: 1000};
sr.reveal('.content__heading, .content__text, .company__quoteblock_slider .company__quotecontent.active .company__quotetext, .company__quoteblock_slider .company__quotecontent.active .company__quoteauthor, .company__quoteblock:not(.company__quoteblock_slider) .company__quotetext, .company__quoteblock:not(.company__quoteblock_slider) .company__quoteauthor, .content__scroll-link, .services__list, .services__quote, .case__smalltext, .content-tabs p, .case__logo, .case__subheading, .case__about p, .case__about h3, .case__about ul', fooReveal);

sr.reveal('.content__scroll-link, .technology__column:nth-child(1), .technology__column:nth-child(2)', fooReveal1);
sr.reveal('.content__scroll-link, .technology__column:nth-child(3), .content__bgphone, .technology__column:nth-child(4)', fooReveal2);
sr.reveal('.content__scroll-link, .technology__column:nth-child(5), .technology__column:nth-child(6)', fooReveal3);




// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}



// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});



// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}



// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){     
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});



// AJAX форма
$(document).ready(function() {
    $('.contacts__form').ajaxForm(function() {
		$('.contacts__form').find('input, textarea, button, p').addClass('active');
    }); 
}); 



// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});



// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}

// Выделение элемента меню при нахождении на соответствующей странице
$(document).ready(function(){
	var page = $('section').data('page');
	console.log(page);
	$('.header__menu a[data-page='+page+']').addClass('active');
});



// Проверка формы на правильность введенных данных
$(".contacts__form button").click(function(e){
	e.preventDefault();
    window.activeform = $(this).parents("form").attr("id");

    checkinputs();
    checkandsubmit();
});


// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();

    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').addClass("error")
    } else {$('#'+activeform+' input[name="email"]').removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find(".error").each(function(){
        formerrors += 1;
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' [data-required]').each(function(){
        if (!$(this).val()) {
            $(this).addClass("error")
        } else {$(this).removeClass("error")}
    });
}

// Убрать ошибку при изменении input'а
$("input, textarea").on("keyup change", function(){
   $(this).removeClass("error");
});


//Появление блока с кейсами на главной
/*
$(document).ready(function(){
	$('.page-main .content-tabs__switcher li[data-width="squares"]').click();
	var mainHeight = $('.content_main').outerHeight();
	$('.page-main').css('max-height', ''+(mainHeight+150)+'px');
	$('.page-main__wrapper').outerHeight(mainHeight);
})

$('.content_main .content__scroll-link').click(function(e){
	e.preventDefault();
	$('.page-main__wrapper').height(0);
	$('.page-main').addClass('active');
	$('.page-main').css('max-height', '1000000px');
});*/


function mobileView(){
if ($(window).width()<=1000) {
    $('.content-tabs__switcher li[data-width="squares"]').click();
}
}

mobileView();

$(window).resize(function(){
    mobileView();
});





$('.page-main .content-tabs__switcher li[data-width="squares"]').click();
setTimeout(mainH, 10);
$(window).scroll(function(){
    var scr = $(this).scrollTop();
    var el1 = $(".content_main");
    var el2 = $(".page-main .cases");
    if (scr>= el1.outerHeight()) {
        el2.addClass("normal"); $(".page-main").addClass("active");
    } else {
        el2.removeClass("normal"); $(".page-main").removeClass("active");
    }
});

function mainH() {
    //if (!$(".page-main").hasClass("active")) {
        $(".page-main").css("min-height", $(".content_main").outerHeight() + $(".page-main .cases").outerHeight());
    //}
}

$(window).resize(function(){
    setTimeout(mainH, 10);
});

$(".content__scroll-link").click(function(e){
    e.preventDefault();
    $('html,body').animate({scrollTop: $(".content_main").outerHeight()}, 1200);
});

// Слайдер картинок в кейсе
$(".case__slider").each(function(){
    var slider = $(this),
        slidesamount = slider.find(".case__slide").length, // кол-во слайдов
        wrapper = slider.find(".case__wrapper"), // wrapper слайдов
        currentslide = 1, // текущий слайд
        animating = false, // анимируется или нет
        animtime = 1400, // время анимации
        autoslidetimeout,
        autoslidedelay = 6000,
        diff = 0,
        slidewidth;

    // Ширина слайда
    $(window).on("load resize", function(){
        slidewidth = slider.width();
        slider.find(".case__slide").width(slidewidth);
    });

    // Переход к след. слайду
    function nextslide() {
        currentslide += 1;
        if (currentslide > slidesamount) {currentslide = 1}
        changeslide();
    }

    // Переход к пред. слайду
    function prevslide() {
        currentslide -= 1;
        if (currentslide < 1) {currentslide = slidesamount}
        changeslide();
    }
    
    slider.find(".case__slidearrows .next").click(function(){
        nextslide(); 
    });
    
    slider.find(".case__slidearrows .prev").click(function(){
        prevslide(); 
    });

    // Сменить слайд
    function changeslide(instant) {
        wrapper.css("transform", "translate3d(-"+(currentslide-1)*(100/slidesamount)+"%,0,0)");
    }    

    if (slider.hasClass("slider_autoplay")) {
      // Автопрокрутка слайдов
      function slideAutoPlay() {
        var interval = 3000;
        sliderTimer = setInterval(autoSlider, interval);
        slider.hover(function(){
            clearInterval(sliderTimer);
        },function(){
            sliderTimer = setInterval(autoSlider, interval);
        });
      }

      function autoSlider() {
        if (!slider.is(":hover")) {
        currentslide += 1;
        if (currentslide > slidesamount) {currentslide = 1}
        changeslide();
        }
      }

      slideAutoPlay();
    }
});











// Слайдер цитат руководителей
$(".company__quoteblock_slider").each(function(){
    var slider = $(this),
        inslider = slider.find(".company__quoteslider"),
        wrapper = inslider.find(".company__quoteslider-wrapper"),
        slidesamount = inslider.find(".company__quoteimage").length, // кол-во слайдов
        slide = wrapper.find(">div"),
        currentslide = 1;
    
    wrapper.width(100*slidesamount + "%");
    slide.width(100/slidesamount + "%");
    

    // Переход к след. слайду
    function nextslide() {
        currentslide += 1;
        if (currentslide > slidesamount) {currentslide = 1}
        changeslide();
    }
    
    slider.find(".company__quotearrow").click(function(event){
        event.preventDefault();
        nextslide(); 
    });

    // Сменить слайд
    function changeslide() {
        wrapper.css("transform", "translate3d("+ (-100/slidesamount)*(currentslide-1) +"%,0,0)");
    }
});






// Параллакс
// Картинка на странице "Пациентам"
function parallax() {
    var el = $(".company__cityview");
    var h1 = el.offset().top;
    var blockheight = el.outerHeight();
    var scroll = $(window).scrollTop();
    if (scroll > (h1 - $(window).height()) ) {
        var percents = (scroll-h1+$(window).height())/$(window).height();
        if (percents<0) {percents = 0}
        if (percents>blockheight) {percents=100}
        el.find("img.colored").css("transform", "translate3d(0,"+-percents*100*0.2+"%,0)");
    }
}

// Запускаем параллакс
$(window).scroll(function(){
	if ($('*').is('.company__cityview')) {
		parallax();
	}
});

// Форма отправки (высота)
function formHeight() {
    var form = $(".contacts__form");
    var fh = form.height();
    form.height(fh);
}
formHeight();
